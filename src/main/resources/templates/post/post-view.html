<!DOCTYPE HTML>
<html land="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:replace="fragment.html :: commonHead"></th:block>
    <link rel="stylesheet" href="/library/tagify/dist/tagify.css">
    <style>
        form{
            display: inline;
        }
        .tagify{
            padding: 3px;
        }
    </style>
</head>
<body>

<div th:replace="fragment.html :: commonNav"></div>

<div class="container">

    <div id="post-view" style="margin-top: 100px">
        <table class="table table-bordered" style="margin: auto; width: 750px; margin-bottom: 35px">
            <tbody>
            <tr>
                <td colspan="2" th:text="${post.getTitle()}" style="padding: 20px 40px 20px 40px;font-size: 24px; font-weight: bold">
                    글 제목
                </td>
            </tr>
            <tr style="text-align: center">
                <td style="min-width:100px"><span>작성자 : </span></td>
                <td style="vertical-align: middle">
                    <a th:href="@{'/account/profile-view/' + ${post.getAuthor().getUserId()}}" th:text="${post.getAuthor().getNickname() + ' (' + post.getAuthor().getUserId() + ')'}">
                        작성자 닉네임(작성자 아이디)
                    </a>
                </td>
            </tr>
            <tr style="text-align: center">
                <td style="min-width:100px"><span>작성일 : </span></td><td style="vertical-align: middle" class="date-weekday-time" th:text="${firstWrittenTime}">글 작성 날짜</td>
            </tr>
            <tr style="text-align: center">
                <td style="min-width:100px;vertical-align: middle"><span>태그 : </span></td>
                <td style="vertical-align: middle"><input name="tag" readonly th:value="${#strings.listJoin(tagOnPost, ',')}"></td>
            </tr>
            <tr>
                <td colspan="2" th:utext="${post.getContent()}" style="padding: 38px 40px 22px 40px;">글 내용</td>
            </tr>
            </tbody>
        </table>

        <div class="text-center" style="margin: 0">
            <a th:if="${isAuthor}" class="btn btn-primary" href="#" th:href="@{'/post-update/' + ${post.getId()}}"
               style="width: 300px; margin-right: 50px">수정하기</a>
            <!-- Button trigger modal -->
            <button th:if="${isAuthor}" type="button" class="btn btn-danger" onclick="show_delete_confirm_modal()" data-toggle="modal" data-target="#postDeleteModal" style="width: 300px">
                삭제하기
            </button>
        </div>

        <form id="delete-form" th:if="${isAuthor}" th:action="@{'/post-delete'}" th:object="${postDeleteRequestDto}" method="post" novalidate>
            <input type="hidden" th:field="*{postIdToDelete}">
        </form>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="postDeleteModal" tabindex="-1" role="dialog" aria-labelledby="postDeleteModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="postDeleteModalLabel">게시글 삭제</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    게시글을 삭제하시겠습니까?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" onclick="delete_submit_func()">삭제</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">취소</button>
                </div>
            </div>
        </div>
    </div>

</div>
<footer th:replace="fragment.html :: commonFooter"></footer>
<script th:replace="fragment.html :: commonJavaScript"></script>
<script src="/library/tagify/dist/tagify.min.js"></script>
<script th:replace="fragment.html :: date-time"></script>
<script type="application/javascript">
    const input = document.querySelector('input[name=tag]');
    tagify = new Tagify(input);

    function show_delete_confirm_modal(){
        $('#postDeleteModal').modal("show");
    }

    function delete_submit_func(){
        document.getElementById('delete-form').submit();
    }
</script>
</body>
</html>