<!DOCTYPE HTML>
<html land="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:replace="main/fragment.html :: commonHead"></th:block>
    <style>
        /* 데스크탑*/
        @media (min-width: 992px) {
            #notificationListTitle {
                margin-top: 53px;
                margin-bottom: 29px;
            }

            #outerBox {
                width: 990px;
            }

            #menuBox{
                width: 182px;
            }

            #changAllToLinkVisitedForm{
                margin-top: 15px;
            }
            #deleteAllLinkVisitedForm{
                margin-top: 10px;
            }

            .formButton{
                width: 100%;
            }

            #allNotificationListOuterDiv {
                margin-left: 40px;
            }

            .notificationCard {
                margin-bottom: 13px;
            }
            .notificationDeleteButton{
                display: inline;
                position: absolute;
                cursor: pointer;
                z-index: 2;
                top: 12px;
                right: 21px;
            }
        }

        /* 태블릿 */
        @media (min-width: 576px) and (max-width: 991.98px) {
            #notificationListTitle {
                margin-top: 37px;
                margin-bottom: 24px;
            }

            #outerBox {
                width: 90%;
            }

            #menuBox{
                width: 182px;
                margin-bottom: 26px;
            }

            #changAllToLinkVisitedForm{
                margin-top: 15px;
            }
            #deleteAllLinkVisitedForm{
                margin-top: 10px;
            }

            .formButton{
                width: 100%;
            }

            #allNotificationListOuterDiv {
            }

            .notificationCard {
                margin-bottom: 18px;
            }
            .notificationDeleteButton{
                display: inline;
                position: absolute;
                cursor: pointer;
                z-index: 2;
                top: 12px;
                right: 21px;
            }
        }

        /* 핸드폰 일반 */
        @media (min-width: 340px) and (max-width: 575.98px) {
            #notificationListTitle {
                margin-top: 33px;
                margin-bottom: 22px;
            }

            #menuBox{
                width: 182px;
                margin-bottom: 26px;
            }

            #changAllToLinkVisitedForm{
                margin-top: 15px;
            }
            #deleteAllLinkVisitedForm{
                margin-top: 10px;
            }

            .formButton{
                width: 100%;
            }

            #allNotificationListOuterDiv {
                width: 560px;
            }

            .notificationCard {
                margin-bottom: 18px;
            }
            .notificationDeleteButton{
                display: inline;
                position: absolute;
                cursor: pointer;
                z-index: 2;
                top: 12px;
                right: 21px;
            }
        }

        /* 초소형 핸드폰 */
        @media (max-width: 339.98px) {
            #notificationListTitle {
                margin-top: 27px;
                margin-bottom: 22px;
            }

            #menuBox{
                width: 182px;
                margin-bottom: 26px;
            }

            #changAllToLinkVisitedForm{
                margin-top: 15px;
            }
            #deleteAllLinkVisitedForm{
                margin-top: 10px;
            }

            .formButton{
                width: 100%;
            }

            #allNotificationListOuterDiv {
                width: 560px;
            }

            .notificationCard {
                margin-bottom: 18px;
            }

            .notificationCardHeader{
                padding-top: 41px;
            }
            .notificationDeleteButton{
                display: inline;
                position: absolute;
                cursor: pointer;
                z-index: 2;
                top: 12px;
                right: 21px;
            }
        }
        #pagination{
            margin-top: 27px;
        }
    </style>
</head>
<body>

<div class="container">
    <div th:replace="main/fragment.html :: commonNav"></div>

    <h2 id="notificationListTitle" class="text-center">알림</h2>

    <div id="outerBox" class="row justify-content-center mx-auto">

        <div id="menuBox" style="display: inline-block">
            <div th:replace="main/fragment.html :: notification-list (currentMenu='all')"></div>
            <form id="changAllToLinkVisitedForm" th:action="@{/notification/change-all-to-link-visited}" method="post">
                <input type="hidden" name="currentUrl" th:value="${T(portfolio2.module.notification.controller.config.UrlAndViewNameAboutNotification).ALL_NOTIFICATION_LIST_URL}">
                <button type="submit" class="btn btn-warning formButton">모두 읽음으로 전환</button>
            </form>
            <form id="deleteAllLinkVisitedForm" th:action="@{/notification/delete-all-link-visited}" method="post">
                <input type="hidden" name="currentUrl" th:value="${T(portfolio2.module.notification.controller.config.UrlAndViewNameAboutNotification).ALL_NOTIFICATION_LIST_URL}">
                <button type="submit" class="btn btn-danger formButton">읽은 알림 모두 삭제</button>
            </form>
        </div>

        <div id="allNotificationListOuterDiv" class="col-lg-8">

            <div th:if="${notificationPage.getTotalElements() == 0}" class="card">
                <div class="card-body text-muted text-center">
                    알림이 없습니다.
                </div>
            </div>

            <div th:id="'notificationCard' + ${notification.id}" th:each="notification : ${notificationPage.getContent()}"
                 class="card text-center notificationCard" th:classappend="${notification.isLinkVisited() ? 'text-black-50' : ''}">
                <div th:if="${notification.notificationType == T(portfolio2.module.notification.NotificationType).NEW_POST_WITH_MY_INTEREST_TAG_IS_POSTED}"
                     class="card-header notificationCardHeader" style="position: relative">
                    관심 태그가 포함된 새로운 글 알림
                    <div class="notificationDeleteButton"
                         th:onclick="'javascript:deleteNotification(' + ${notification.id} + ');'">
                        <i class="fas fa-times"></i>
                    </div>
                </div>
                <div th:if="${notification.notificationType == T(portfolio2.module.notification.NotificationType).MY_INTEREST_TAG_IS_ADDED_TO_UPDATED_POST}"
                     class="card-header">
                    관심 태그가 추가된 글 알림
                </div>
                <div class="card-body">
                    <h5 class="card-title">
                        <span th:if="${notification.notificationType == T(portfolio2.module.notification.NotificationType).NEW_POST_WITH_MY_INTEREST_TAG_IS_POSTED ||
                                       notification.notificationType == T(portfolio2.module.notification.NotificationType).MY_INTEREST_TAG_IS_ADDED_TO_UPDATED_POST}"
                              th:each="tag : ${notification.commonTag}">
                            <span th:text="${tag.getTitle()}"></span>
                            <span th:if="${#bools.isFalse(tagStat.last)}">,</span>
                        </span>
                    </h5>
                    <p class="card-text" th:if="${notification.notificationType == T(portfolio2.module.notification.NotificationType).NEW_POST_WITH_MY_INTEREST_TAG_IS_POSTED}">
                        위의 관심 태그가 포함된 새로운 글이 게시되었습니다.
                    </p>
                    <p class="card-text" th:if="${notification.notificationType == T(portfolio2.module.notification.NotificationType).MY_INTEREST_TAG_IS_ADDED_TO_UPDATED_POST}">
                        위의 관심 태그가 추가된 글이 있습니다.
                    </p>
                    <p class="card-text">
                        아래의 링크를 클릭해 확인해 보세요!
                    </p>
                    <a th:href="@{'/notification/link-visit/' + ${notification.id}}" type="button" class="btn btn-light" th:classappend="${notification.isLinkVisited() ? 'text-black-50' : ''}">
                        "<span th:text="${notification.title}"></span>"
                    </a>
                </div>
                <div class="card-footer time-before" th:text="${notification.getCreatedDateTime()}" th:classappend="${notification.isLinkVisited() ? 'text-black-50' : 'text-primary'}">
                    2 days ago
                </div>
            </div>

            <nav th:if="${notificationPage.getTotalPages() >= 1}" id="pagination" aria-label="Page navigation example">
                <ul class="pagination justify-content-center">
                    <li class="page-item" th:classappend="${!notificationPage.hasPrevious()}? disabled">
                        <a th:href="@{'/notification/list/all?sort=' + ${sortProperty} + ',desc&page=' + ${notificationPage.getNumber() - 1}}"
                           class="page-link" aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                    <!--
                        (0 ~ 4) / 5 = 0 -> 0 ~ 4 but max = 4
                        (5 ~ 9) / 5 = 1 -> 5 ~ 9 but max = 9
                        (10 ~ 14) / 5 = 2 -> 10 ~ 14 but max = 14
                        (15 ~ 19) / 5 = 3 -> 15 ~ 19 but max = 19
                        (20 ~ 24) / 5 = 4 -> 20 ~ 24 but max = 24
                     -->
                    <li class="page-item" th:classappend="${currentPageNumberIndex == notificationPage.getNumber()}? active"
                        th:each="currentPageNumberIndex: ${#numbers.sequence(currentPageRangeFirstIndex, currentPageRangeLastIndex)}">

                        <a th:href="@{'/notification/list/all?sort=' + ${sortProperty} + ',desc&page=' + ${currentPageNumberIndex}}"
                           class="page-link" href="#" th:text="${currentPageNumberIndex + 1}">1</a>

                    </li>

                    <li class="page-item" th:classappend="${!notificationPage.hasNext()}? disabled">
                        <a th:href="@{'/notification/list/all?sort=' + ${sortProperty} + ',desc&page=' + ${notificationPage.getNumber() + 1}}"
                           class="page-link" aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

</div>
<footer th:replace="main/fragment.html :: commonFooter"></footer>
<script th:replace="main/fragment.html :: commonJavaScript"></script>
<script th:replace="main/fragment.html :: momentjs"></script>
<script th:replace="main/fragment.html :: ajax-csrf-header"></script>
<script type="application/javascript">
    function deleteNotification(notificationId) {
        $.ajax({
            autocomplete: {
                enabled: true,
                rightKey: true,
            },
            contentType: "application/json; charset=utf-8",
            method: "POST",
            url: "/notification/delete",
            data: JSON.stringify({'notificationIdToDelete': notificationId})
        }).done(function () {
            $("#notificationCard" + notificationId).fadeOut(300,
                function () {
                    $(this).remove();
                }
            );
        });
    }
</script>
</body>
</html>